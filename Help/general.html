<!DOCTYPE html>
<html>
<head>
<style>
table, th, td {
    border: 1px solid orange;
    border-collapse: collapse;
}
th, td {
    padding: 5px;
}
</style>
</head>
<body>
<h1>www sites</h1>
<p>
<table>
<tr>
    <td><a href="https://github.com/ROCmSoftwarePlatform/rocBLAS">rocBLAS</a><br></td>
    <td>https://github.com/ROCmSoftwarePlatform/rocBLAS</td>
</tr><tr>
    <td><a href="https://github.com/ROCmSoftwarePlatform/hipBLAS">hipBLAS</a><br></td>
    <td>https://github.com/ROCmSoftwarePlatform/hipBLAS</td>
</tr><tr>
    <td><a href="https://bitbucket.org/multicoreware/hcblas">hcBLAS</a><br></td>
    <td>https://bitbucket.org/multicoreware/hcblas</td>
</tr><tr>
    <td><a href="https://github.com/ROCmSoftwarePlatform/Tensile">Tensile</a><br></td>
    <td>https://github.com/ROCmSoftwarePlatform/Tensile</td>
</tr><tr>
    <td><a href="https://github.com/AMDComputeLibraries/MLOpen">MIOpen</a><br></td>
    <td>https://github.com/AMDComputeLibraries/MLOpen</td>
</tr><tr>
    <td><a href="https://bitbucket.org/multicoreware/hipcaffe">hipCaffe</a><br></td>
    <td>https://bitbucket.org/multicoreware/hipcaffe</td>
</tr><tr>
    <td><a href="https://github.com/rocmsoftwareplatform/deepbench-v1">Deepbench</a><br></td>
    <td>https://github.com/RadeonOpenCompute/deepbench</td>
</tr><tr>
    <td><a href="http://docs.nvidia.com/cuda/cublas/#introduction">cuBLAS</a><br></td>
    <td>http://docs.nvidia.com/cuda/cublas/#introduction</td>
</tr><tr>
    <td><a href="https://github.com/ecrc/kblas-gpu">KBLAS</a><br></td>
    <td>https://github.com/ecrc/kblas-gpu</td>
</tr><tr>
    <td><a href="http://hsautil.amd.com/job/ROCmSoftwarePlatform/">hsUtil</a><br></td>
    <td>http://hsautil.amd.com/job/ROCmSoftwarePlatform/</td>
</tr><tr>
    <td><a href="https://github.com/amcamd/TestAndDebug">TestAndDebug</a><br></td>
    <td>https://github.com/amcamd/TestAndDebug</td>
</tr><tr>
    <td><a href="https://github.com/hyln9/GCNGEMM">hgemm gcngemm</a><br></td>
    <td>https://github.com/hyln9/GCNGEMM</td>
</tr><tr>
    <td><a href="http://developer.amd.com/wordpress/media/2017/08/Vega_Shader_ISA_28July2017.pdf">Vega10 ISA</a><br></td>
    <td>http://developer.amd.com/wordpress/media/2017/08/Vega_Shader_ISA_28July2017.pdf</td>
</tr>
</table>


<p>
<a href="https://radeonopencompute.github.io">https://radeonopencompute.github.io</a><br>
<a href="http://hsautil.amd.com/job/ROCmSoftwarePlatform">http://hsautil.amd.com/job/ROCmSoftwarePlatform</a><br>
<a href="https://code.visualstudio.com/">Code Visual Studio</a><br>
<a href="https://cmake.org/cmake-tutorial/">Cmake Tutorial</a><br>
<a href="https://www.docker.com">https://www.docker.com</a><br>
<a href="https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet">Editing Github Wiki </a><br>
<a href="http://ontrack-internal.amd.com/browse/SWDEV-103388">Jira example</a><br>


<h1>Ubuntu setup</h1>

<ul>
  <li><pre>uname -a</pre>
    <ul>
      <li>print system information, all
    </ul>
  <li><pre>lsb_release -a</pre>
    <ul>
      <li>print distribution-specific information (Linux Standard Base)
    </ul>
  <li><pre>lspci</pre>
    <ul>
      <li>list all PCI devices
    </ul>
  <li><pre>sudo apt-get update</pre>
    <ul>
      <li>APT package handling utility (Advanced Package Tool).
      <li>Downloads the package lists from the repositories and "updates" them to get information on the newest versions of packages and their dependencies.
    </ul>
  <li><pre>sudo apt-get upgrade</pre>
    <ul>
      <li>fetch new versions of packages existing on the machine if APT knows about these new versions by way of apt-get update
    </ul>
  <li><pre>ip route get 8.8.8.8 | awk '{print $NF; exit}'</pre>
    <ul>
      <li>get the ip address, alternative command is ifconfig
    </ul>
  <li><pre>sudo lsblk, sudo blkid, ls -l /dev/disk/bu-uuid, </pre>
    <ul>
      <li>disk information
    </ul>
  </li>
  <li><pre>hipconfig</pre>
    <ul>
      <li>hip information
    </ul>
  </li>
  <li>adduser
    <ul>
      <li><pre>sudo useradd --create-home -G sudo --shell /bin/bash &lt;username&gt;</pre>
      <li><pre>sudo passwd &lt;username&gt;</pre>
    </ul>
  </li>
  <li><pre>gsettings set org.gnome.desktop.wm.preferences focus-mode 'mouse'</pre>
    <ul>
      <li>focus follows mouse
    </ul>
  </li>
  <li><pre>dumping isa while compiling by exporting environment variable</pre>
    <ul>
      <li>export KMDUMPISA=1
    </ul>
  </li>
  <li><pre>Two changes to prevent terminal freeze</pre>
    <ul>
      <li>In the application <code>Software & Updates</code>,<br> 
          go to <code>Additional Drivers</code><br> 
          Under the <code>Unknown: Unknown</code> tag select the radio button for<br>
          <code>Using Processor microcode firmware 
            for AMD CPUs from amd64-microcode (proprietary)</code> 
      <li><code>sudo vim /etc/default/grub</code><br>
          Find the line <code>GRUB_CMDLINE_LINUX_DEFAULT="quiet splash"</code><br>
          change it to <code>GRUB_CMDLINE_LINUX_DEFAULT="quiet splash intel_idle.max_cstate=1"</code>
    </ul>
  </li>
  <li><pre>extract c++ function name from mangled name</pre>
    <ul>
        <li><code>c++filt -n _ZN7rocblas13device_mallocEm</code>
    </ul>
  </li>
  <li><pre>suspend ubuntu terminal</pre>
    <ul>
      <li><code>systemctl suspend</code>
    </ul>
  </li>
  <li><pre>for message  libmcwamp_cpu.so: cannot open shared object file: </pre>
    <ul>
      <li><code>export LD_LIBRARY_PATH=/opt/rocm/lib</code>
    </ul>
  </li>
  <li><pre>to get device information</pre>
      <ul>
          <li><code>/opt/rocm/bin/rocm_agent_enumerator</code>
      </ul>
  </li>

</ul>

<h1>ROCM1.6 installation</h1>
<p>Instructions at 
    <td><a href="https://github.com/RadeonOpenCompute/ROCm">ROCm</a><br></td>
<pre>
--- Add the ROCM apt repository
wget -qO - http://10.255.8.5/rocm/apt/debian/rocm.gpg.key | sudo apt-key add -
sudo sh -c 'echo deb [arch=amd64] http://10.255.8.5/rocm/apt/debian/ xenial main > /etc/apt/sources.list.d/rocm.list'

--- Uninstall previous ROCM packages
sudo apt-get purge libhsakmt
sudo apt-get purge radeon-firmware
sudo apt-get purge $(dpkg -l | grep 'kfd\|rocm' | grep linux | grep -v libc | awk '{print $2}')

--- Install or update
sudo apt-get update
sudo apt-get install rocm

sudo apt-get install hsa-ext-rocr-dev hsakmt-roct-dev hsa-rocr-dev

</pre>


<h1>VIM</h1>
<p>To substitute new line use \r. For example: <pre>1,$s/newline/\r/</pre>
<p>To insert tab when expandtab option is ON: <pre>i , &lt;CTRL&gt;&lt;v&gt; , &lt;tab&gt;  (i is for insert mode)</pre>
<p>Visual Block Mode: Ctrl V, move cursor to highlight block, y or d (for yank or delete), move cursor to pup block, p (for put)

<h1>Excel row-by-row conditional formatting</h1>
<p>Select (or high-light) the block of rows and columns
<p>Select &lt;HOME&gt;&lt;Conditional Formatting&gt;&lt;New Rule&lt;Use a formula to determine which cells to format&gt;
<p>To get the min values  =A1=MIN($A1:$C1)
<p>Select &lt;Format&gt;, choose a Fill color

<h1>Dev Box</h1>
<table>
<tr>
    <td>computer name</td>	<td>MSDNdevBox1</td>
</tr><tr>
    <td>username</td>           <td>achapman</td>
</tr><tr>
    <td>password</td>	        <td></td>
<tr>
</table>

<h1>Admin Box</h1>
<table>
<tr>
    <td>computer name</td>	<td>MSDN-AUS-anchap</td>
</tr><tr>
    <td>username</td>           <td>amd\anchapman</td>
</tr><tr>
    <td>password</td>	        <td></td>
</tr>
</table>


<h1>Jenkins</h1>
<table>
<tr>
    <td>username</td>           <td>achapman</td>
</tr><tr>
    <td>password</td>	        <td></td>
</tr><tr>
    <td> Fiji rocm-1.3 and 1.4</td>
    <td> ssh -p 1313 achapman@jenkins-rocm-1 </td>
    <td> ssh -p 1414 achapman@jenkins-rocm-1 </td>
    <td> ssh -p 1515 achapman@jenkins-rocm-1 </td>
</tr>
</tr><tr>
    <td> Hawaii rocm-1.3 and 1.4</td>
    <td> ssh -p 1313 achapman@jenkins-rocm-0 </td>
    <td> ssh -p 1414 achapman@jenkins-rocm-0 </td>
    <td> ssh -p 1515 achapman@jenkins-rocm-0 </td>
</tr>
</table>

<p>To restart -p 1515 jenkins-rocm-1, <code>sudo docker start rocm-v1.5</code>

<h1>other machines</h1>
<table>
<tr>
   <td>cuda machines</td> <td>jenkins-cuda-0 (kepler)</td> <td>fpNvidia01</td>
</tr><tr>
   <td>ROCM1.6 machine</td> <td>fsp9300-1, 10.236.104.210</td>
</tr>
</table>


<h1>GitBucket</h1>
<table>
<tr>
    <td>user.name</td>	<td>amcamd</td>
</tr><tr>
    <td>user.email</td>           <td>andrew.chapman@amd.com</td>
</tr><tr>
    <td>password</td>	        <td></td>
</tr>
</table>

<h1>GitHub</h1>
<table>
<tr>
    <td>user.name</td>	<td>amcamd</td>
</tr><tr>
    <td>user.email</td>           <td>andrew.chapman@amd.com</td>
</tr><tr>
    <td>password</td>	        <td></td>
</tr>
</table>
<h4>lola alias</h4>
<pre>
[alias]
        lol = log --graph --decorate --pretty=oneline --abbrev-commit
        lola = log --graph --decorate --pretty=oneline --abbrev-commit --all
[color]
        branch = auto
        diff = auto
        interactive = auto
        status = auto
</pre>
<h4>Configuring a remote for a fork</h4>
<ul>
<li><pre>
===: git remote -v
<samp>
origin	https://github.com/amcamd/rocBLAS.git (fetch)
origin	https://github.com/amcamd/rocBLAS.git (push)
</samp></pre>

<li><pre>
===: git remote add upstream https://github.com/ROCmSoftwarePlatform/rocBLAS
</pre>

<li><pre>
===: git remote -v
<samp>
origin	https://github.com/amcamd/rocBLAS.git (fetch)
origin	https://github.com/amcamd/rocBLAS.git (push)
upstream	https://github.com/ROCmSoftwarePlatform/rocBLAS (fetch)
upstream	https://github.com/ROCmSoftwarePlatform/rocBLAS (push)
</samp>
</pre>
</ul>


<h4>Syncing a fork</h4>
<ul>

<li><pre>
===: git fetch upstream
<samp>
remote: Counting objects: 1, done.
remote: Total 1 (delta 0), reused 0 (delta 0), pack-reused 0
Unpacking objects: 100% (1/1), done.
From https://github.com/ROCmSoftwarePlatform/rocBLAS
 * [new branch]      develop    -> upstream/develop
 * [new branch]      master     -> upstream/master
</samp></pre>

<li><pre>
===: git checkout develop
<samp>
Already on 'develop'
Your branch is up-to-date with 'origin/develop'.
</samp></pre>

<li>Alternative 1<pre>
===: git merge upstream/develop
<samp>
Updating db0918e..e4bd4ae
Fast-forward
</samp></pre>

<li>Alternative 2:
<pre>
===: git rebase upstream/develop develop
<samp>
First, rewinding head to replay your work on top of it...
Fast-forwarded develop to upstream/develop.
</samp></pre>

<li>Alternative 3, Merge strategy favors upstream/develop:
<pre>
===: git rebase -s recursive -X ours upstream/develop develop
</pre>

<li>To get changes from local copy back into origin/develop:
<pre>
===: git push
</pre>
</ul>

<h4>Patch</h4>
<ul>
<li>To generate a patch from the topmost n commits from a specific sha1 hash:
<pre>
===:git format-patch -&lt;n&gt; &lt;SHA1&gt;
</pre>

<li>for example to generate a patch from the most recent commit to HEAD:
<pre>
===:git format-patch -1 HEAD
</pre>

<li>To check a patch and then apply it without committing changes:
<pre>
===: git apply --check name.patch
===: git apply name.patch
</pre>

<li>To reverse the patch:
<pre>
===: git apply --reverse name.patch
</pre>
</ul>

<h4>Revert</h4>
<ul>
<li><code>git revert &lt;oldest_commit_hash&gt;..&lt;latest_commit_hash&gt; </code>

<li>A solution that keeps no traces of the "undo". NOTE: don't do this 
if someone allready pulled your change (I would use this only on my personal repo)
<pre>
git reset &lt;previous label or sha1&gt;
</pre>

<li>this will re-checkout all the updates locally (so git status will 
list all updated files). Then you "do your work" and re-commit your 
changes (Note: this step is optional)
<pre>
git commit -m "blabla"
</pre>

<li>At this moment your local tree differs from the remote. The following
will push and force remote to consider this push and remove the previous one:
<pre>
git push -f
</pre>


<li>!! watch-out some tags may still be pointing removed commit !!
</ul>

<h4>Merge or "squash" multiple commits into one</h4>
<ul>
<li>To list commits: <code>git log --pretty=oneline</code>

<li>To merge last 5 commits: <code>git rebase -i HEAD~5</code>

<li>In editor change all but oldest commit from pick to squash. 
<li>Quit editor, and add commit 
comment in next editor. 
<li>If you have already pushed commits then force push with:

<pre>git push --force    (or git push origin branch-name --force)</pre>
</ul>


<h4>pull request from cherry-pick commit</h4>

<p>You need to basically create a new branch upstreamDevelop & cherry-pick the commits you want to add to it.

<pre>git remote add upstream &lt;git repository&gt;</pre>

<pre>git remote update</pre>

<p>create new branch upstreamDevelop that is copy of upstream/develop
<pre>git checkout -b upstreamDevelop upstream/develop</pre>

<p>get the commit (or commits) you want
<pre>git cherry-pick &lt;SHA hash of commit&gt;</pre>

<p>to push the new branch upstreamDevelop to origin</pre>
<pre>git push origin upstreamDevelop</pre>

<p>You will now see new branch upstreamDevelop in your "origin" repositiory at githup

<h4>Changing a commit message</h4>
<p>For the latest commit
<ul>
<li><code>git commit --amend</code>
<li>If commit has been pushed, force push with:  <code>git push --force</code>
</ul>

<p>For an older commit, say second last
<ul>
<li><code>git rebase -i HEAD~2</code>
<li>change the text from <code>pick</code> to <code>edit</code> in the message you want to change
<li>Then:
<ul>
<li><code>git commit --amend</code>

<li><code>git rebase --continue</code>
<li>you will likely also need <code>git push --force</code>
</ul>
</ul>

<h4>Merge develop into master and release</h4>
<ul>
<li> <code>mkdir -p ~/repos/rocBLASmergeDevelop; cd ~/repos/rocBLASmergeDevelop</code>

<li> <code>git clone https://github.com/ROCmSoftwarePlatform/rocBLAS.git</code>

<li> <code>cd rocBLAS</code>
<li> <code>git checkout develop</code>
<li> change rocBLAS/CMakeLists.txt to 0.4.2.0
<ul>
    <li> <code>vim CMakeLists.txt</code>
   <li> <code>git add CMakeLists.txt</code>
   <li> <code>git commit -m"version for master branch release"</code>
</ul>

<li> <code>git checkout master</code>
<li> <code>git merge develop</code>
<li> <code>git checkout develop</code>
<li> <code>git merge master --ff-only</code>  # getting the develop branch to include the new merge commit

<li> change rocBLAS/CMakeLists.txt 0.5.2.0
<ul>
  <li> <code>vim CMakeLists.txt</code>
  <li> <code>git add CMakeLists.txt</code>
  <li> <code>git commit -m"version for develop branch at release"</code>
</ul>

<li> <code>git push --all</code>

<li> go to  https://github.com/ROCmSoftwarePlatform/rocBLAS.git

<li> under repository name click &lt;Releases&gt;

<li> click &lt;Draft a new release&gt;
<ul>

<li> select MASTER branch 
<li>enter <a href="http://semver.org">Semantic Versioning</a> version tag
<li>enter Title and notes
<li>add .deb and .rpm files from Jenkins. You may need to use Chrome browser
  in place of Firefox for adding .deb and .rpm.
<li> click &lt;Publish release&gt;
</ul>
</ul>


<h1>Useful commands</h1>
<p>find ./rocBLAS-develop -type f -exec grep -l gemv {} \; 

<h1>Build rocBLAS</h1>
<p>
cmake-gui 2.8 does not work. Use ccmake or cmake-gui 3.5. Get ccmake with: "sudo apt-get install cmake-curses-gui"
<p>
To avoid compiling tensor
<ul><li> comment out gemm lines in file: ~/repos/rocBLAS-develop/clients/benchmarks/client.cpp
<pre>
/* #include "testing_gemm.hpp" */

/*  else if (function == "gemm"){
        if (precision == 's')
            testing_gemm<float>( argus );
        else if (precision == 'd')
            testing_gemm<double>( argus );
    } */
</pre>
<li>In file clients/gtest/CMakeLists.txt comment out the lines for gemm and trsm as below
<pre>
 set(Tensile_TEST_SRC
#    gemm_gtest.cpp
#    trsm_gtest.cpp
     )
</pre>
</ul>
<p>
Choose Tensile_REPO in rocBLAS/cmake/external-Tensile.cmake
</p>


<pre>
cd ~/repos/rocBLAS-develop-build
rm -rf *
ccmake ../rocBLAS -DHIP_ROOT=/opt/rocm/hip -DBOOST_ROOT=/usr/local -DCMAKE_CXX_COMPILER=/usr/bin/clang++ -DCMAKE_C_COMPILER=/usr/bin/clang

can also set 
-DCMAKE_BUILD_TYPE=Release 
-DBUILD_WITH_TENSILE=OFF 
-DCMAKE_CXX_FLAGS='fPIC'

Fiji_ROCm_1.4

make -j                (option make VERBOSE=1 >& make.out)
cd clients-build
cd benchmarks-build
make
</pre>
<p>
Library will be in:<br>
~/repos/rocBLAS-develop-build/library-package/lib/x86_64-linux-gnu/librocblas-hcc.a<br>
~/repos/rocBLAS-develop-build/library-build/src/librocblas-hcc.a
<p>
Samples are in: ~/repos/rocBLAS-develop-build/clients-build/samples-build<br>
To run sample: ./example-sscal
<p>
To run tests:
<pre>
cd clients-build/tests-build
make
staging/rocblas-test
</pre>
<p>To run only tests with name matching ger
<code>staging/rocblas-test --gtest_filter=*ger*</code>
<p>
To run benchmarks:
<pre>
cd ~repos/rocBLAS-develop-build/clients-build/benchmarks-build
make
./client -h
./client  -f gemv -r s -m 1024 -n 256
./client  -f gemv -r s
./client -v 1
./client -f gemm -r s -m 1024 -n 1024 -k 1024 --transposeB T
</pre>
<h1>Benchmark Code</h1>
<p>
<ul><li> The code for the executable is in clients/benchmarks/client.cpp. 
<li>boost::program_options is used for parsing the command line. 
<li>The instance argus of the class Arguments is from the file clients/include/utility.h. 
<li>client.cpp contains include files like clients/include/testing_ger.hpp that 
    call the routine to be timed.
</ul>
<h1>Tensile</h1>
<pre>
mkdir -p ~/repos/TensileWalkthrough; cd ~/repos/TensileWalkthrough
git clone https://github.com/ROCmSoftwarePlatform/Tensile.git repo
mkdir build; cd build; cmake ../repo

line 103 of ~/repos/TensileWalkthrough/repo/clients/gemm/gemm.cpp
Convert if to #if 1 so list of dimensions used, not combinatorics

In file below list dimensions and num_gemm_params in line 19 "const unsigned int num_gemm_params = 1;"
~/repos/TensileWalkthrough/repo/clients/gemm/dnn_gemms.h

in directory ~/repos/TensileWalkthrough/build: 
make gemm; clients/gemm/gemm

only training data file GEMM.xml from previous command should be in directory build/ProblemXMLs

Train with the command:
python ../repo/TensileGen/Tensile.py benchmark --backend hip --problems-path ~/repos/TensileWalkthrough/build/ProblemXMLs --solutions-path ~/repos/TensileWalkthrough/build/Solution

Output will be in above directory --solutions-path in a file like:
Fiji__Radeon_R9_FURY___NANO_Series__CT_SSSSS_Cij_Aki_Bkj_O0.xml

To build rocBLAS library librocblas-hcc.a copy above xml file to directory
~/clone3-rocBLAS/rocBLAS/library/src/blas3/Tensile/SolutionXMLs/Fiji_ROCm_1.4

when running rocBLAS ccmake, specify Fiji_ROCm_1.4, this will use .xml file you just copied

To build Tensile library (not the rocBLAS library):

Edit ~/repos/TensileWalkthrough/repo/clients/gemm/CMakeLists.txt 
and remove # below
add_tensile_lib(TensileLib_GEMM EXCLUDE_FROM_ALL
  PROBLEMS ${Tensile_DIR_PROBLEMS}
  #SOLUTIONS ${Tensile_DIR_PROBLEMS}/../SolutionXMLs
  BACKEND ${Tensile_BACKEND}
  ENABLE_LOGGER
)

Rebuild gemm with full backend with:
~/repos/TensileWalkthrough/build  cmake --build . --target gemm

This will build the library

~/repos/TensileWalkthrough/build/clients/gemm/libTensileLib_GEMM.a

</pre>
<h1>Timing with C++11</h1>
<pre>
#include &lt;chrono&gt;
  std::chrono::time_point&lt;std::chrono::high_resolution_clock&gt; start, end;
  std::chrono::duration&lt;double&gt;dur;
  hipDeviceSynchronize();
  start = std::chrono::high_resolution_clock::now();
    status = hcblasSgemm(handle, typeA, typeB, M, N, K, &amp;alpha, 
    d_A, lda, d_B, ldb, &amp;beta, d_C, ldc);
  hipDeviceSynchronize();
  end = std::chrono::high_resolution_clock::now();
  dur = end - start;
  double gemmSec= dur.count();

  printf("dur, gemmSec = %f, %f\n",dur, gemmSec);
  double gflops = (double)(M) * (double)(N) * (double)(K) * 2.0 / gemmSec / 1e9;
  printf("gflops = %f\n",gflops);


Alternative explicit cast to microseconds. Do not cast to seconds for jobs
running for &lt; 1sec, because it truncates so you will loose all precition
less than one second.
  double gemmSec2= chrono::duration_cast&lt;chrono::microseconds&gt;(end - start).count();

</pre>
The event timer can also be used. It gives results similar to C++11 chrono.
<pre>
#include &lt;hip/hip_runtime.h&gt;
#include &lt;hip/hip_runtime_api.h&gt;

  hipEvent_t hipStart, hipStop;
  hipEventCreate(&hipStart);
  hipEventCreate(&hipStop);

  hipEventRecord(hipStart);

  hipEventRecord(hipStop);

  float milliseconds = 0;
  hipEventElapsedTime(&milliseconds, hipStart, hipStop);

</pre>



<h1>Building hcBLAS</h1>
<p> To build hcBLAS I needed to change the following line in /lib/src/CMakeLists.txt
<pre>
set (HCC_LDFLAGS "${HCC_LDFLAGS} -L${HIP_PATH}/lib -lhip_hcc -Wl,-rpath-link,${HIP_PATH}/lib")
</pre>
to 
<pre>
set (HCC_LDFLAGS "${HCC_LDFLAGS} -L${HIP_PATH}/lib /opt/rocm/lib/libCXLActivityLogger.so -lhip_hcc -Wl,-rpath-link,${HIP_PATH}/lib")
</pre>
note the addition of /opt/rocm/lib/libCXLActivityLogger.so   
<p>
To run hcblas/test/benchmark you may need to set the following environment variables:
<pre>
> export CODEXL_PATH=/opt/rocm/profiler/bin

> LD_LIBRARY_PATH=$LD_LIBRARY_PATH:/home/achapman/hcblasClone/hcblas/test/benchmark
> export LD_LIBRARY_PATH

> export HCBLAS_PATH=/home/achapman/hcblasClone/hcblas
</pre>

<h1>ATITOOL (atitool)</h1>

<ul>
    <li>get atitool from
        <ul>
            <li><a href="http://gpudiagnostics/release">http://gpudiagnostics/release</a>
            <li>Click <code>diagnostic tools</code> button at top
            <li>Click <code>ATITool</code> link on left panel, download latest release
        </ul>
    <li>put fan on full
        <ul>
            <li><code>sudo ./atitool -fancontrol=1</code>
        </ul>

    <li>set clock to 1500MHz
        <ul>
            <li>set soc voltage first
                <ul>
                    <li><code>sudo ./atitool --vddcr_soc=1.1</code>
                </ul>
            <li>set clock
                <ul>
                    <li><code>sudo ./stitool --eng=1500</code>
                </ul>
        </ul>

    <li>disable DPM
        <ul>
            <li>sudo vi /etc/default/grub
            <li>add value <code>amdgpu.dpm=0"</code> to <code>GRUB_CMDLINE_LINUX_DEFAULT</code>
            <li><code>sudo update-grub</code>
            <li>restart your system</li>
        </ul>
</ul>



<h1>rocm-smi  (ROCm System Management Interface</h1>
<p>Run <code>rocm-smi --help</code> for information. Below commands set
the device 1 clock to level 7 (1000 Hz) before a command, and then resets to
default after command.
<pre>
rocm-smi -d 1 --setsclk 7
sleep 1
rocm-smi -d 1 -g

./rocblas_sgemm_example

#reset device 1 clock to default values
rocm-smi -d 1 -r
</pre>

<h1>Single user runlevel N S</h1>
<p>
The command <pre>runlevel</pre> will show the runlevel. To boot the machine in runlevel N S
edit /etc/default/grub to change from

<pre>
GRUB_CMDLINE_LINUX_DEFAULT="quiet splash"
#GRUB_TERMINAL=console
#GRUB_GFXMODE=640x480
</pre>

to 

<pre>
GRUB_CMDLINE_LINUX_DEFAULT="text single"
GRUB_TERMINAL=console
GRUB_GFXMODE=640x480
</pre>

Then run <pre>sudo update-grub</pre> Reboot, and the machine should come up with runlevel N S.
Reverse the changes to get back to runlevel N 2.
<p>
For Ubuntu 16 see
<a href="http://askubuntu.com/questions/788323/change-runlevel-on-16-04">http://askubuntu.com/questions/788323/change-runlevel-on-16-04</a><br>

<h1>Tensile V2</h1>

<pre>

cd repos
mkdir Version2
cd Version2
git clone https://github.com/ROCmSoftwarePlatform/Tensile.git

cd Tensile

git checkout develop

sudo apt-get python-pip
sudo apt-get install python-pip 
* sudo python setup.py install 
pip install .
pip list

tensile -h
mkdir ../tempDir
cd ../tempDir
tensile ../Tensile/Tensile/Configs/rocblas_sgemm.yaml .

alternative: python ../Tensile/Tensile/Tensile.py ../Tensile/Tensile/Configs/rocblas_sgemm.yaml .

cd 4_LibraryClient/
cd build/
./client 
./client 0 128 129 130
./client 0 128 129 130 0
./client 0 128 129 130 -1

cd Tensile/
ls
vi Kernels.cpp 
</pre>

<h1>Docker</h1>
<p>https://hub.docker.com  account is   amcamd
<p>On Ubuntu machine, can log in with <pre>sudo docker login</pre>
<p>To see all docker containers</p>
<pre>
sudo docker ps -a
</pre>
<p>To attach to docker container</p>
<pre>
sudo docker attach &lt;docker number&gt;
</pre>
<p>To pull docker image sunway13/ubuntu14.04:promote-free-v2</p>
<pre>
sudo docker pull sunway513/ubuntu14.04:promote-free-v2
</pre>
<p>To run docker image sunway13/ubuntu14.04:promote-free-v2</p>
<pre>
sudo docker run -it --rm --device "/dev/kfd" sunway513/ubuntu14.04:promote-free-v2 env TERM=xterm-color bash -l
</pre>
<pre>
sudo docker run -it --rm --device "/dev/kfd" --device "/dev/dri" sunway513/ubuntu14.04:promote-free-v2
</pre>
<p>To remove a docker container, first get CONTAINER ID with 
<pre>sudo docker ps -a</pre>
Next use command 
<pre>docker rm &lt;CONTAINER ID&gt;</pre>

<h3>To commit a docker image as: sunway513/hipcaffe:rocblas</h3>
<pre>In another terminal on the host machine find the docker image #ID with: sudo docker ps

Commit the image ID with:
sudo docker commit #ID sunway513/hipcaffe:rocblas

Push to dockerhub repo with:
sudo docker push sunway513/hipcaffe:rocblas
</pre>

<h3>To open docker on jenkins-cuda-0</h3>

sudo docker run -it -u 1000:1000 --device=/dev/nvidiactl --device=/dev/nvidia0 --device=/dev/nvidia-uvm --device=/dev/nvidia-uvm-tools --volume-driver=nvidia-docker --volume=nvidia_driver_384.90:/usr/local/nvidia:ro  hipblas/build-hipblas-hip-artifactory:latest

<h3>To install hip on cuda machine</h3>
<pre>
wget -qO - http://packages.amd.com/rocm/apt/debian/rocm.gpg.key | sudo apt-key add -
sudo sh -c 'echo deb [arch=amd64] http://packages.amd.com/rocm/apt/debian/ xenial main > /etc/apt/sources.list.d/rocm.list'

sudo apt-get install hip_nvcc
</pre>
To get the developer-preview branch
<pre>
git clone -b developer-preview https://github.com/GPUOpen-ProfessionalCompute-Tools/HIP.git
cd HIP && mkdir build && cd build && cmake .. && sudo make install
</pre>

<h3>To install OpenCL</h3>

<p>Commands below are from the
<a href="https://github.com/RadeonOpenCompute/ROCm">ROCm site</a><br>

<pre>sudo apt-get install rocm rocm-opencl</pre>

<pre>sudo apt-get install rocm-opencl-dev</pre>

<h1>Artifactory</h1>

<p>
http://compute-artifactory.amd.com/artifactory/webapp/#/artifacts/browse/tree/General/deb-experimental-local
<p>
http://compute-artifactory.amd.com/artifactory/webapp/#/artifacts/browse/tree/General/rocm-docker-github/kknox/hcc/clang_tot_upgrade/hcc-lc-ubuntu-16.04

<p>
edit /etc/apt/sources.list.d/rocm.list

<p>
change
deb [arch=amd64] http://packages.amd.com/rocm/apt/debian/ xenial main

<p>
to something like
deb [arch=amd64] http://compute-artifactory.amd.com/rocm/apt/debian/ xcnial 
<p>
or
<p>
http://compute-artifactory.amd.com/artifactory/webapp/#/artifacts/browse/tree/General/rocm-release-1.6-deb/amd/rocm
<p>
or
<p>
deb [arch=amd64] http://compute-artifactory.amd.com/artifactory/list/rocm-release-1.6-deb/ xenial main
<p>
or
<p>
deb [arch=amd64] http://10.255.8.5/rocm/apt/debian/ xenial main

<h1>clang-format</h1>
<ul>
    <li><a href="https://dx13.co.uk/articles/2015/4/3/Setting-up-git-clang-format.html">Setting up git-clang-format</a><br></li>
    <li><a href="https://clang.llvm.org/docs/ClangFormatStyleOptions.html">clang-format style options</a><br></li>
    <li><a href="http://clang.llvm.org/docs/ClangFormat.html#vim-integration">clang-format VIM integration</a><br></li>
</ul>
<ul>
    <li>install clang-format with: <code>sudo apt-get update; sudo apt-get install clang-format</code></li>
    <li><a href="https://llvm.org/svn/llvm-project/cfe/trunk/tools/clang-format/git-clang-format">Download git-clang-format from here</a><br></li>
    <li>make it executable with chmod +x ~/bin/git-clang-format</li>
    <li>check its been picked pu by git: <code>git clang-format -h</code></li>
    <li>Try it out with <code>git clang-format --diff</code></li>
</ul>
<ul>
    <li> To format a file: <code>clang-format-3.8 -style=file -i <path_to_source_file></code>
    <li> To format at checkin: <code>./.githooks/install</code>
</ul>

<h1>Visual Studio Code</h1>
<ul>
    <li>to start, click on icon, or search for "Visual Studio Code"
    <li>directory .vscode is added
    <li>gear wheel brings up .vscode/launch.json file. Add the following to configurations in .vscode/launch.json</li>
    <li><pre> "args": [
                "./Tensile/Tensile/Configs/rocblas_sgemm_asm_single_kernel.yaml", "~/tensile-gen"
            ]</pre></li>
    <li>bug icon brings up debug view</li>
    <li>you need to be viewing the file Tensile.py when you start debugging</li>

</body>
</html>
